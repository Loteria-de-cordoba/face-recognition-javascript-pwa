<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>LPCSE - Control de ingreso a salas</title>

    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <!-- <link rel="manifest" href="assets//site.webmanifest"> -->
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <meta http-equiv="Content-Security-Policy" content="block-all-mixed-content">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="jquery-3.7.1/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>

    <script src="sweetalert2@11/sweetalert2@11.js"></script>
    <script src="librerias/twbs-pagination-master/jquery.twbsPagination.min.js" type="text/javascript"></script>
    <!-- <script src="librerias/fontawesome-free-6.4.2-web/js/all.min.js"></script> -->
    <script src="backoffice.js"></script>
    <script type="text/javascript" src="app.js"></script>
    <!-- <script type="text/javascript" src="js/app.js"></script> -->




</head>

<body>
    <div class="container">
        <div class="row mt-3">
            <div class="col-sm-4"></div>
            <div class="col-sm-4">

                <img src="assets/logo-loteria.jpg" width="100" height="45" alt="Lotería de Córdoba S.E.">

                <div class="card mt-3">

                    <div class="card-header text-center">
                        <h1 class="h2 mt-3">Control de Ingreso</h1>
                        <p class="lead">RRHH
                        </p>
                    </div>

                    <div class="card-body">
                        <!-- <form> -->
                        <div class="row mt-3">
                            <div class="col-sm-12">
                                <div class="row mt-3">
                                    <div class="col-md-12 mb-2">
                                        <!-- <label for="exampleInputEmail1" class="form-label">Email</label> -->
                                        <input type="email" class="form-control" id="InputEmail" placeholder="Email"
                                            aria-describedby="emailHelp" required>
                                        <div class="valid-feedback">
                                            Direccion valida!
                                        </div>
                                        <div class="invalid-feedback">
                                            Por favor complete...
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-12 mb-2">
                                        <input type="password" class="form-control" id="InputPassword"
                                            placeholder="Password">
                                        <div class="valid-feedback">
                                            Correcto!
                                        </div>
                                        <div class="invalid-feedback">
                                            Por favor complete...
                                        </div>
                                    </div>
                                </div>

                                <div class="row mt-3">
                                    <div class="col-md-12 d-flex justify-content-start">
                                        <button type="botton" onclick="enviarForm('A');"
                                            class="btn btn-primary btn-block">Administracion</button>
                                    </div>
                                </div>

                                <div class="row mt-3">
                                    <!-- <div class="col-md-1"></div> -->
                                    <div class="col-md-9" role="status" style="display:none;" id="spinner">
                                        <strong>Loading...</strong>
                                        <div class="spinner-grow text-primary" role="status">
                                            <!-- <span class="visually-hidden">Loading...</span> -->
                                        </div>
                                        <!-- <div class="spinner-grow text-secondary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div> -->
                                        <div class="spinner-grow text-success" role="status">
                                            <!-- <span class="visually-hidden">Loading...</span> -->
                                        </div>
                                        <div class="spinner-grow text-danger" role="status">
                                            <!-- <span class="visually-hidden">Loading...</span> -->
                                        </div>
                                        <div class="spinner-grow text-warning" role="status">
                                            <!-- <span class="visually-hidden">Loading...</span> -->
                                        </div>
                                        <div class="spinner-grow text-info" role="status">
                                            <!-- <span class="visually-hidden">Loading...</span> -->
                                        </div>
                                        <!-- <div class="spinner-grow text-dark" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div> -->
                                    </div>
                                </div>

                                <!-- </form> -->
                            </div>

                        </div>

                    </div>
                    <!-- <div class="col-sm-3"></div> -->
                </div>

            </div>
        </div>
        <div class="col-sm-4"></div>
    </div>




</body>

<script>

    // Función para obtener el parámetro 'id' de la URL
    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    // Obtener el parámetro 'server' de la URL que es la url que lo llamo
    var server = getParameterByName('server');

    // var server = window.location.host;

    // if (localStorage.getItem("CI-token") === null) {
    //     $('#qrcode_bo').hide();
    // } else {
    //     var token = localStorage.getItem("CI-token");
    // }

    // new QRCode(document.getElementById("qrcode_wt"), {
    //     text: `https://${server}/frontend/views/selector.html`,
    //     width: 100,
    //     height: 100,
    //     colorDark: "red",
    //     colorLight: "#ffffff",
    //     correctLevel: QRCode.CorrectLevel.H
    // });

    // new QRCode(document.getElementById("qrcode_bo"), {
    //     text: `https://${server}/frontend/views/backoffice.html`,
    //     width: 100,
    //     height: 100,
    //     colorDark: "green",
    //     colorLight: "#ffffff",
    //     correctLevel: QRCode.CorrectLevel.H
    // });


    $(document).ready(function () {

        $('#InputEmail').val("php.1722@gmail.com");
        $('#InputPassword').val("ultrasiete");

        $("#InputEmail").on('input', function () {
            validarEmail($("#InputEmail"));
        });

        $("#InputPassword").on('input', function () {
            validarCampo($("#InputPassword"));
        });

    });

    function validarCampo(obj) {
        if (obj.val() != "") {
            obj.removeClass("is-invalid").addClass("is-valid");
        } else {
            obj.removeClass("is-valid").addClass("is-invalid");
        }
    }

    function validarEmail(obj) {
        if (/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(obj.val())) {
            obj.removeClass("is-invalid").addClass("is-valid");
        } else {
            obj.removeClass("is-valid").addClass("is-invalid");
        }
    }

    function enviarForm(opcion) {

        $('#spinner').show();

        headers = {
            accion: 'login'
        };


        variables = {
            email: $('#InputEmail').val(),
            password: $('#InputPassword').val()
        };

        if (opcion == 'A') {
            destino = `backoffice.html?server=${server}`;
            // } else if (opcion == 'W') {
            //     destino = `../views/selector.html`;
            // } else if (opcion == 'B') {
            //     destino = `../views/backoffice.html`;

        }

        $.ajax({
            type: "POST",
            // url: 'http://localhost/face-recognition-javascript/backend/api/usuarios/',
            // url: 'https://localhost/control-ingreso-salas/index.php',            
            url: `https://${server}/backend/api/usuarios/index.php`,
            data: JSON.stringify(variables),
            headers: headers,
            // dataType: 'json',
            // xhrFields: {
            //     withCredentials: false
            // }
            // // Esto configura la opción rejectUnauthorized para manejar certificados SSL inválidos
            // // Solo necesario en entornos Node.js
            // beforeSend: function (xhr) {
            //     xhr.setRequestHeader('rejectUnauthorized', 'false');
            // }
        }).done(function (data) {
            // alert("Data Loaded: " + data);
            console.log(data);
            //var obj = jQuery.parseJSON(data);
            if (data.ok) {
                localStorage.setItem('CI-token', data.token);
                window.location.href = destino;
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Something went wrong!',
                    footer: '<a href="">Why do I have this issue?</a>'
                })
            }
        }).fail(function () {
            alert("Error, no se pudo realizar la consulta!...");
        }).always(function () {
            // alert("finished");
        });

    }
</script>